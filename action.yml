name: 'statix-action'
description: 'Lint Nix code, and optionally create a pull request'
inputs:
  action:
    description: 'statix action'
    required: false
    default: 'check'
  directory:
    description: 'Directory on which to run statix'
    required: false
    default: '.'
  create_pr:
    description: 'Whether to create a PR'
    required: false
    default: 'false'
  commit_message:
    description: 'Commit message'
    required: false
    default: 'Lint Nix code'
runs:
  using: "composite"
  steps:
    - name: Lint Nix code
      run: 'nix run nixpkgs#statix -- ${{ inputs.action }} ${{ inputs.directory }}'
      shell: bash
      id: statix
    - run: |
        if ! git diff --quiet --exit-code ; then
          git commit -a -F - <<EOF
          ${{ inputs.commit_message }}
        EOF
        fi
      if: inputs.create_pr == 'true'
      env:
        GIT_AUTHOR_NAME: github-actions[bot]
        GIT_AUTHOR_EMAIL: <github-actions[bot]@users.noreply.github.com>
        GIT_COMMITTER_NAME: github-actions[bot]
        GIT_COMMITTER_EMAIL: <github-actions[bot]@users.noreply.github.com>
      shell: bash
    - name: Create PR
      if: inputs.create_pr == 'true'
      uses: peter-evans/create-pull-request@v3
      with:
        branch: statix-lint
        delete-branch: true
        title: "${{ inputs.commit_message }}"
        body: |
          Automated linting performed by the [statix-action](https://github.com/jocelynthode/statix-action) GitHub Action.
branding:
    icon: 'minus-circle'
    color: 'red'
